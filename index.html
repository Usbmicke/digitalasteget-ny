
<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digi Dan - Din AI Byggkonsult</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --accent-color: #00A9FF; 
            --accent-color-light: #7de0ff; 
            --accent-color-dark: #007bb5;
            --bg-dark-primary: #0a0e1a; 
            --bg-dark-secondary: #172033;
            --text-primary: #F9FAFB; 
            --text-secondary: #9CA3AF; 
            --border-color: #374151;
            --template-bg-color: rgba(42, 53, 72, 0.9); /* Slightly lighter than secondary for templates */
        }
        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-dark-primary); 
            color: var(--text-primary); 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            cursor: default; 
            margin: 0;
        }
        ::-webkit-scrollbar { width: 8px; } 
        ::-webkit-scrollbar-track { background: transparent; } 
        ::-webkit-scrollbar-thumb { background: #2a354d; border-radius: 4px; } 
        ::-webkit-scrollbar-thumb:hover { background: var(--border-color); }

        #dna-background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0; /* Behind all other content */
            pointer-events: none; /* Make it non-interactive */
            background-color: var(--bg-dark-primary); /* Base background color */
        }

        #mouse-trail { 
            position: fixed; 
            width: 24px; height: 24px; 
            background-color: var(--accent-color); 
            border-radius: 50%; 
            pointer-events: none; 
            z-index: 9999; 
            opacity: 0.15; 
            transform: translate(-50%, -50%); 
            transition: transform 0.1s ease-out, opacity 0.2s ease-out;
            filter: blur(5px); 
            will-change: transform;
        }
         body:not(:hover) #mouse-trail {
            opacity: 0;
        }

        .page-wrapper { display: flex; flex-direction: column; height: 100%; width: 100%; position: relative; z-index: 5; }
        
        .header { 
            padding: 1rem 1.5rem; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            flex-shrink: 0; 
            background-color: rgba(10, 14, 26, 0.8); 
            backdrop-filter: blur(8px);
            border-bottom: 1px solid var(--border-color);
        }
        .header-title-link { 
            display: flex; 
            align-items: baseline; 
            gap: 0.5rem; 
            font-size: 1.25rem; 
            font-weight: 600; 
            text-decoration: none; 
            color: var(--text-primary); 
            padding: 0.25rem 0.5rem; 
            cursor: pointer; 
            border-radius: 6px; 
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
        }
        .header-title-link span { font-style: italic; font-size: 0.9rem; color: var(--text-secondary); font-weight: 400; }
        .header-title-link:hover { 
            box-shadow: 0 0 15px rgba(0, 169, 255, 0.4); 
            background: rgba(0, 169, 255, 0.1); 
        }
        .header-buttons button { 
            background-color: rgba(42, 54, 78, 0.7); 
            backdrop-filter: blur(5px); 
            border: 1px solid var(--border-color); 
            color: var(--text-primary); 
            padding: 0.5rem 1rem; 
            border-radius: 8px; 
            font-size: 0.875rem; 
            font-weight: 500; 
            transition: all 0.2s ease-out; 
            display: inline-flex; 
            align-items: center; 
            gap: 0.5rem; 
            cursor:pointer;
        }
        .header-buttons button:hover { 
            border-color: var(--accent-color); 
            box-shadow: 0 0 15px rgba(0, 169, 255, 0.4);
            background-color: rgba(0, 169, 255, 0.2);
        }

        .main-view { 
            flex-grow: 1; 
            display: flex;
            flex-direction: column; 
            padding: 0 1rem; /* Adjusted padding */
            overflow: hidden; 
            align-items: center; 
            justify-content: center; 
        }
        
        #chat-view { 
            display: flex; 
            flex-direction: column; 
            height: 100%; 
            width: 100%; 
            max-width: 800px; 
            position: relative; 
        }
        #chatMessages { 
            flex-grow: 1; 
            overflow-y: auto; 
            padding: 0 0.5rem; 
            display: flex; 
            flex-direction: column;
            gap: 0.5rem; 
        }
        .chat-messages-inner { 
            display: flex; 
            flex-direction: column; 
            gap: 1rem; 
            padding-top: 1rem; 
            padding-bottom: 1rem; 
        }
        .chat-message-item { /* New wrapper for each message/template */
            display: flex;
            flex-direction: column;
        }
        .chat-bubble { 
            padding: 0.75rem 1.25rem; 
            border-radius: 18px; 
            max-width: 85%; 
            word-wrap: break-word; 
            font-size: 0.95rem; 
            line-height: 1.6; 
            white-space: pre-wrap; 
            border: 1px solid transparent; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }
        .chat-bubble-user { 
            background-color: var(--accent-color); 
            color: #fff; 
            font-weight: 500; 
            align-self: flex-end; 
            margin-left: auto; 
            border-bottom-right-radius: 6px; 
        }
        .chat-bubble-ai { 
            background-color: var(--bg-dark-secondary); 
            border-color: var(--border-color); 
            color: var(--text-primary); 
            align-self: flex-start; 
            margin-right: auto; 
            border-bottom-left-radius: 6px; 
        }
        .chat-bubble-ai-initial { 
            align-self: center; 
            text-align: center; 
            max-width: 550px; 
            background-color: transparent; 
            border: none; 
            backdrop-filter: none; 
            box-shadow: none;
            color: var(--text-secondary);
            font-style: italic;
        }
        .chat-bubble-ai-wide { max-width: 98%; }
        
        .template-block {
            background-color: var(--template-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 0.5rem; /* Space from preceding AI message */
            margin-bottom: 0.5rem; /* Space before next user message */
            max-width: 98%;
            align-self: flex-start;
            width: auto; /* Allow it to not take full width if content is narrow */
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            position: relative;
        }
        .template-block-preamble {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            font-style: italic;
        }
        .template-block-content {
            white-space: pre-wrap;
            font-family: 'Courier New', Courier, monospace; /* Monospaced for better template structure view */
            font-size: 0.9rem;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
            background-color: rgba(0,0,0,0.1);
            padding: 0.75rem;
            border-radius: 6px;
        }
        .template-block-content h1, .template-block-content h2, .template-block-content h3 {
            font-family: 'Inter', sans-serif; /* Revert to normal font for headings in template */
            color: var(--accent-color-light);
            margin-top: 0.5em;
            margin-bottom: 0.25em;
        }
         .template-block-content h1 { font-size: 1.2em; font-weight: 600; }
         .template-block-content h2 { font-size: 1.1em; font-weight: 500; }
         .template-block-content h3 { font-size: 1.0em; font-weight: 500; }
         .template-block-content strong { font-weight: bold; color: var(--text-primary); }
         .template-block-content ul, .template-block-content ol { margin-left: 1.5rem; margin-bottom: 0.5rem; }
         .template-block-content li { margin-bottom: 0.25rem; }
         .template-block-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
            font-size: 0.9em;
         }
         .template-block-content th, .template-block-content td {
            border: 1px solid var(--border-color);
            padding: 0.35rem 0.5rem;
            text-align: left;
         }
         .template-block-content th {
            background-color: rgba(0, 169, 255, 0.1);
         }

        .copy-template-button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            margin-top: 0.75rem;
        }
        .copy-template-button:hover {
            background-color: var(--accent-color-light);
        }
        .copy-template-button svg {
            width: 14px;
            height: 14px;
        }


        .chat-input-container { 
            flex-shrink: 0; 
            padding-top: 1rem; 
            max-width: 800px; 
            width: 100%; 
            z-index: 5; 
        }
        .chat-input-wrapper { 
            background-color: rgba(31, 41, 55, 0.95); 
            border: 1px solid var(--border-color); 
            border-radius: 12px; 
            padding: 0.5rem; 
            display: flex; 
            align-items: flex-end; 
            transition: border-color 0.2s ease, box-shadow 0.3s ease-out; /* Added box-shadow transition */
        }
        .chat-input-wrapper:focus-within {
            border-color: var(--accent-color);
            box-shadow: 0 0 8px rgba(0, 169, 255, 0.3);
        }
        .chat-input-wrapper.thinking {
            border-color: var(--accent-color) !important; /* Ensure border color override */
            animation: pulse-input-glow 1.5s infinite;
        }

        @keyframes pulse-input-glow {
            0% { box-shadow: 0 0 8px rgba(0, 169, 255, 0.4); }
            50% { box-shadow: 0 0 18px rgba(0, 169, 255, 0.8); }
            100% { box-shadow: 0 0 8px rgba(0, 169, 255, 0.4); }
        }

        .chat-input-wrapper textarea { 
            background: transparent; 
            border: none; 
            outline: none; 
            width: 100%; 
            color: var(--text-primary); 
            font-size: 1rem; 
            resize: none; 
            max-height: 150px; 
            line-height: 1.5; 
            padding: 0.5rem; 
        }
        .chat-input-wrapper textarea::placeholder {
            color: var(--text-secondary);
            opacity: 0.7;
        }
        #sendButton { 
            background-color: var(--accent-color); 
            padding: 0.6rem; 
            border-radius: 10px; 
            flex-shrink: 0; 
            align-self: flex-end; 
            margin: 4px; 
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        #sendButton:hover:not(:disabled) {
            background-color: var(--accent-color-light);
        }
        #sendButton:disabled { 
            background-color: #4B5563; 
            cursor: not-allowed; 
        }
        #sendButton svg {
            display: block; 
        }
        #thinking-text-container {
            text-align: center;
            margin-bottom: 0.5rem; /* Space between text and input box */
            height: 1.2em; /* Reserve space to prevent layout shift */
            line-height: 1.2em;
        }
        #thinking-text {
            font-style: italic;
            color: var(--text-secondary);
            font-size: 0.9rem;
            animation: thinking-text-glow 1.8s ease-in-out infinite;
        }
        @keyframes thinking-text-glow { 
            0%, 100% { opacity: 0.7; } 
            50% { opacity: 1; } 
        }

        .disclaimer { 
            font-size: 0.75rem; 
            color: var(--text-secondary); 
            text-align: center; 
            padding: 0.75rem; 
            /* height: 2em; removed */
            /* line-height: 1em; removed */
        }
        .disclaimer a { text-decoration: underline; cursor: pointer; color: var(--accent-color-light); }
        .disclaimer a:hover { color: var(--accent-color); }
        
        #info-view { 
            display: none; 
            height: calc(100% - 2rem); 
            width: 100%;
            max-width: 1100px; 
            overflow-y: auto; 
            background: rgba(17, 24, 39, 0.95); 
            border-radius: 12px; 
            border: 1px solid var(--border-color); 
            padding: 2rem; 
            position: relative; 
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }
        #info-view::-webkit-scrollbar { display: block; }

        #close-info-button-inner { 
            position: absolute; 
            top: 1rem; right: 1rem; 
            font-size: 1.8rem; 
            background: none; 
            border: none; 
            color: var(--text-secondary); 
            cursor: pointer; 
            z-index: 10; 
            padding: 0.5rem; 
            line-height: 1;
            transition: color 0.2s ease;
        }
        #close-info-button-inner:hover {
            color: var(--text-primary);
        }

        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2.5rem; align-items: center; }
        @media (max-width: 768px) { 
            .info-grid { grid-template-columns: 1fr; gap: 2rem; } 
            #info-view { padding: 1.5rem; overflow-x: hidden; } 
        }
        #info-content h3 { 
            color: var(--accent-color); 
            font-weight: 600; 
            font-size: 1.35rem; 
            margin-top: 1.5rem; 
            margin-bottom: 0.75rem; 
            border-bottom: 1px solid var(--border-color); 
            padding-bottom: 0.5rem; 
            text-transform: none; 
        }
        #info-content p, #info-content li { font-size: 1rem; color: var(--text-secondary); line-height: 1.7; }
        #info-content ul { list-style-type: '✓'; padding-left: 1.5rem; margin-top: 1rem; }
        #info-content li { margin-bottom: 0.5rem; } 
        #info-content li::marker { color: var(--accent-color); font-weight: bold; padding-right: 0.5em; }
        #info-content strong { color: var(--text-primary); font-weight: 500;}
        
        .about-founder { margin-top: 3rem; border-top: 1px solid var(--border-color); padding-top: 2rem; }
        .about-founder h3 {
            color: var(--accent-color); font-weight: 600; font-size: 1.35rem; margin-bottom: 0.75rem; 
            border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; text-transform: none; 
        }
        
        .info-image-container { 
            position: relative; 
            min-height: 400px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            gap: 1.5rem; 
            padding: 1rem;
        }
        .info-image-container svg {
            width: 5rem; 
            height: 5rem; 
            color: var(--accent-color);
            opacity: 0.8;
        }
        .twin-text { 
            font-size: 3.5rem; 
            font-weight: 700; 
            color: var(--text-primary); 
            text-shadow: 0 0 10px rgba(0, 169, 255, 0.4), 0 0 20px rgba(0, 169, 255, 0.3); 
        }
        .orbit-ring { 
            position: absolute; 
            border-radius: 50%; 
            border: 1px solid; 
            animation: rotate-slow infinite linear; 
            pointer-events: none; 
        }
        .ring1 { width: 250px; height: 250px; border-color: var(--accent-color); animation-duration: 25s; opacity: 0.7; }
        .ring2 { width: 350px; height: 350px; border-color: var(--accent-color-light); animation-duration: 40s; animation-direction: reverse; opacity: 0.4; border-style: dashed; }
        .ring3 { width: 450px; height: 450px; border-color: var(--accent-color-dark); animation-duration: 55s; opacity: 0.2; border-style: dotted; }
        
        @keyframes rotate-slow { 
            from { transform: translate(-50%, -50%) rotate(0deg); } 
            to { transform: translate(-50%, -50%) rotate(360deg); } 
        }
        .info-image-container .orbit-ring {
            top: 50%; 
            left: 50%; 
        }

        .privacy-modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background-color: rgba(0,0,0,0.8); 
            display: none; align-items: center; justify-content: center; 
            z-index: 100; 
            padding: 1rem; 
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .privacy-modal-overlay.visible {
            opacity: 1;
        }
        .privacy-modal-content { 
            background-color: var(--bg-dark-secondary); 
            color: var(--text-secondary); 
            padding: 2.5rem; 
            border-radius: 12px; 
            border: 1px solid var(--border-color); 
            max-width: 700px; 
            width: 100%;
            max-height: 85vh; 
            overflow-y: auto; 
            position: relative; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            transform: scale(0.95);
            transition: transform 0.3s ease-in-out;
        }
        .privacy-modal-overlay.visible .privacy-modal-content {
            transform: scale(1);
        }

        .privacy-modal-content h2 { color: var(--text-primary); font-size: 1.75rem; margin-bottom: 1.5rem; }
        .privacy-modal-content h3 { color: var(--accent-color); font-size: 1.2rem; margin-top: 1.5rem; margin-bottom: 0.75rem; }
        .privacy-modal-content p { margin-bottom: 1rem; line-height: 1.6; }
        
        #close-privacy-button { 
            position: absolute; 
            top: 1rem; right: 1rem; 
            font-size: 1.8rem; 
            color: var(--text-secondary); 
            cursor: pointer; 
            background: none; 
            border: none;
            padding: 0.5rem;
            line-height: 1;
            transition: color 0.2s ease;
        }
        #close-privacy-button:hover {
            color: var(--text-primary);
        }

    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <canvas id="dna-background-canvas"></canvas>
    <div id="mouse-trail"></div>

    <div class="page-wrapper">
        <header class="header">
            <a href="#" id="header-title" class="header-title-link" aria-label="Tillbaka till chatten">Digi Dan <span>- Din Digitala AI byggkonsult</span></a>
            <div class="header-buttons flex items-center gap-2 md:gap-4">
                <button id="info-button" aria-label="Visa Information och Hjälp">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    <span>Info & Hjälp</span>
                </button>
                <button id="connect-button" aria-label="Koppla Google Konto">
                     <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"></path></svg>
                    <span>Koppla Konto</span>
                </button>
            </div>
        </header>
        <div class="main-view">
            <div id="chat-view">
                <div id="chatMessages" role="log" aria-live="polite"><div class="chat-messages-inner"></div></div>
                <div class="chat-input-container" role="form" aria-label="Chattformulär">
                    <div id="thinking-text-container" style="display: none;" aria-live="polite">
                        <span id="thinking-text">Dan knegar för fullt...</span>
                    </div>
                    <div class="chat-input-wrapper">
                        <textarea id="userInput" placeholder="Skriv din fråga till Digi Dan..." rows="1" disabled aria-label="Din fråga till Digi Dan"></textarea>
                        <button id="sendButton" title="Skicka meddelande" disabled aria-label="Skicka meddelande">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="24" height="24">
                                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="disclaimer">
                        <span id="disclaimer-text" class="block sm:inline">Digi Dan kan göra misstag. Dubbelkolla viktig information.</span>
                        <a id="privacy-link" class="block sm:inline ml-0 sm:ml-2 mt-1 sm:mt-0" href="#" role="button" aria-label="Läs om din integritet och Digi Dan">Din integritet & Digi Dan</a>
                    </div>
                </div>
            </div>
            <div id="info-view" role="region" aria-label="Information om Digi Dan"></div>
        </div>
    </div>
    
    <div id="privacy-modal" class="privacy-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="privacy-modal-title" style="display: none;">
        <div class="privacy-modal-content">
            <button id="close-privacy-button" aria-label="Stäng integritetsdialog">×</button>
            <h2 id="privacy-modal-title">Din Integritet & Digi Dan</h2>
            <h3>Syfte och Datainsamling</h3>
            <p>Digi Dan är ett verktyg framtaget för att effektivisera och assistera i byggprojekt. Den information du skriver i chatten används enbart för att formulera ett svar från AI-modellen och sparas temporärt för att upprätthålla en kontextuell konversation.</p>
            <h3>Google Konto-integration (Frivilligt)</h3>
            <p>Om du väljer att använda "Koppla Konto"-funktionen, ger du Digi Dan tillstånd att, på din begäran, läsa information från din Google Kalender och Gmail via säkra, standardiserade protokoll (OAuth 2.0). Ingen data från ditt Google-konto lagras permanent av Digi Dan. All åtkomst sker i realtid och endast när du initierar en åtgärd som kräver det.</p>
            <h3>Ansvarsfriskrivning och AI:ns Begränsningar</h3>
            <p><strong>Viktigt:</strong> Digi Dan är ett avancerat stödverktyg, inte en ersättning för professionell, mänsklig expertis. Svaren som genereras kan innehålla fel, felaktigheter eller vara inaktuella. All information, särskilt gällande kalkyler, lagtexter och riskanalyser, måste <strong>alltid dubbelkollas och verifieras av en kvalificerad person.</strong> Användning sker helt på egen risk. Digi Dan och dess utvecklare frånsäger sig allt ansvar för eventuella konsekvenser som uppstår vid användning av informationen som tillhandahålls.</p>
        </div>
    </div>

    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
      <symbol id="icon-copy" viewBox="0 0 24 24">
        <path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
      </symbol>
    </svg>

    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^0.14.0",
    "marked": "https://esm.sh/marked@^15.0.12" 
  }
}
</script>
    <script type="module" src="public/index.js"></script>
<script type="module" src="/index.tsx"></script>
</body>
</html>